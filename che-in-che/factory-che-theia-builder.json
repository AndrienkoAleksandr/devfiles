{
  "v": "4.0",
  "name": "chetheia_builder",
  "workspace": {
    "defaultEnv": "default",
    "environments": {
      "default": {
        "machines": {
          "ws/git": {
            "attributes": {
              "memoryLimitBytes": "322122547"
            },
            "servers": {},
            "volumes": {
              "projects": {
                "path": "/projects"
              }
            },
            "installers": [],
            "env": {}
          },
          "ws/dev": {
            "attributes": {
              "memoryLimitBytes": "3221225472"
            },
            "servers": {
              "che-theia-dev": {
                "attributes": {},
                "port": "3130",
                "protocol": "http"
              }
            },
            "volumes": {
              "projects": {
                "path": "/projects"
              }
            },
            "installers": [],
            "env": {}
          }
        },
        "recipe": {
          "type": "kubernetes",
          "content": "kind: List\nitems:\n - \n  apiVersion: v1\n  kind: Pod\n  metadata:\n   name: ws\n  spec:\n   containers:\n    - \n     image: 'eclipse/che-theia-dev:nightly'\n     name: dev\n     resources:\n      limits:\n       memory: 3072Mi\n    - \n     image: sunix/git-devtools\n     name: git\n     resources:\n      limits:\n       memory: 307.19999980926514Mi\n",
          "contentType": "application/x-yaml"
        }
      }
    },
    "projects": [
      {
        "links": [],
        "name": "theia",
        "attributes": {},
        "type": "blank",
        "source": {
          "location": "https://github.com/theia-ide/theia.git",
          "type": "git",
          "parameters": {
            "branch": "master"
          }
        },
        "path": "/theia",
        "description": "",
        "mixins": [],
        "problems": []
      },
      {
        "links": [],
        "name": "che-theia",
        "attributes": {},
        "type": "blank",
        "source": {
          "location": "https://github.com/eclipse/che-theia.git",
          "type": "git",
          "parameters": {
            "branch": "master"
          }
        },
        "path": "/che-theia",
        "description": "",
        "mixins": [],
        "problems": []
      },
      {
        "links": [],
        "name": "devfiles",
        "attributes": {},
        "type": "blank",
        "source": {
          "location": "https://github.com/sunix/devfiles.git",
          "type": "git",
          "parameters": {
            "branch": "master"
          }
        },
        "path": "/devfiles",
        "description": "",
        "mixins": [],
        "problems": []
      }
    ],
    "name": "chetheia_builder",
    "attributes": {
      "editor": "org.eclipse.che.editor.theia:master",
      "plugins": "che-machine-exec-plugin:0.0.1"
    },
    "commands": [
      {
        "commandLine": "cd /projects/theia/ && git reset --hard v0.3.18 && che:theia init",
        "name": "1. INIT che:theia init",
        "attributes": {
          "machineName": "ws/dev",
          "goal": "Build"
        },
        "type": "custom"
      },
      {
        "commandLine": "cd /projects/theia/ && rm che/ -rf && rm packages/@che* && rm examples/assembly/ -rf && git fetch --all && git reset --hard origin/master",
        "name": "1.1 CLEAN INIT cleanup che:theia init",
        "attributes": {
          "machineName": "ws/dev",
          "goal": "Build"
        },
        "type": "custom"
      },
      {
        "commandLine": "cd /projects/theia/ && jq .command.run.concurrency=1 lerna.json  > lerna.json.tmp && mv lerna.json.tmp lerna.json && yarn",
        "name": "2. BUILD Theia (concurrency=1)",
        "attributes": {
          "machineName": "ws/dev",
          "goal": "Build"
        },
        "type": "custom"
      },
      {
        "commandLine": "cd /projects/che-theia/plugins/factory-plugin/ && yarn",
        "name": "3. BUILD factory-plugin",
        "attributes": {
          "machineName": "ws/dev",
          "goal": "Build"
        },
        "type": "custom"
      },
      {
        "commandLine": "cd /projects/che-theia/plugins/factory-plugin/ && yarn && yarn test-watch",
        "name": "3.1 TEST factory-plugin (watch)",
        "attributes": {
          "machineName": "ws/dev",
          "goal": "Build"
        },
        "type": "custom"
      },
      {
        "commandLine": "rm /default-theia-plugins/eclipse_che_theia_factory_plugin.theia || true && mkdir -p /projects/theiadev_projects && export CHE_PROJECTS_ROOT=/projects/theiadev_projects && export HOSTED_PLUGIN=/projects/che-theia/plugins/factory-plugin/ && cd /projects/theia/examples/assembly && export GIT_EXEC_PATH=/usr/libexec/git-core && export USE_LOCAL_GIT=true && export LOCAL_GIT_DIRECTORY=/usr && yarn start /projects/theiadev_projects --hostname=0.0.0.0 --port=3130",
        "name": "4. RUN Theia AND factory-plugin",
        "attributes": {
          "previewUrl": "${server.che-theia-dev}",
          "goal": "Build",
          "machineName": "ws/dev"
        },
        "type": "custom"
      }
    ],
    "links": []
  },
  "ide": {
    "onProjectsLoaded": {
      "actions": [
        {
          "properties": {
            "name": "3.bis TEST factory-plugin (watch)"
          },
          "id": "runCommand"
        },
        {
          "properties": {
            "file": "devfiles/che-in-che/factory-che-theia-builder.md"
          },
          "id": "openFile"
        }
      ]
    }
  }
}
